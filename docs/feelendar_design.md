# Feelendar Product & Data Design

## 1. 화면 플로우 및 컴포넌트 설계
### 전체 사용자 여정
1. **온보딩/로그인 화면**
   - 이메일/소셜 로그인 버튼, 비밀번호 입력 필드.
   - 신규 사용자용 감정 기록 튜토리얼 모달.
2. **홈(오늘의 감정 기록) 화면**
   - 상단: 오늘 날짜, "오늘의 감정" 카드(이모지 선택 컴포넌트, 감정 강도 슬라이더).
   - 중앙: 감정 이유 텍스트 입력 필드, 태그 선택 컴포넌트.
   - 하단: 공개 범위 드롭다운(비공개/친구/전체), 기록 저장 버튼.
3. **감정 타임라인 화면**
   - 감정 카드 리스트(날짜별, 공개 범위 아이콘 표시).
   - 필터 바(기간, 감정 타입, 공개 범위).
   - 기록 상세 모달(감정, 이유, 첨부 이미지/파일, 댓글 영역).
4. **커뮤니티 피드 화면**
   - 상단: 추천 감정 스토리 캐러셀.
   - 피드 카드: 작성자 아바타/닉네임, 감정 이모지, 공감/댓글 버튼.
   - 사이드바: 트렌딩 태그, 친구 제안 리스트.
5. **통계 화면**
   - 주/월별 감정 차트(막대/도넛 차트 컴포넌트).
   - 감정 분포 테이블, 최고/최저 감정 요약 카드.
   - 기간 선택기, 데이터 내보내기 버튼.
6. **프로필 화면**
   - 사용자 헤더(프로필 이미지, 닉네임, 상태 메시지, 공개 범위 배지).
   - 통계 요약 카드, 친구 목록, 게시물 탭.

### 컴포넌트 목록
- **EmotionPicker**: 감정 타입을 이모지/색상으로 선택.
- **IntensitySlider**: 1~5 단계 감정 강도.
- **VisibilitySelector**: 비공개/친구/전체 옵션 및 커스텀 리스트.
- **ReasonInput**: 텍스트, 태그 자동완성, 첨부파일 버튼.
- **EmotionCard**: 요약, 공개 범위 아이콘, 공감/댓글 수.
- **StatsChart**: 주별 감정 집계 시각화.
- **ProfileHeader**: 사용자 정보, 팔로우/친구 요청 버튼.

## 2. 감정 기록 문서 구조 정의
EmotionEntry (문서 또는 DB 레코드)
- `entry_id` (UUID)
- `user_id`
- `emotion_type` (enum: 행복, 슬픔, 분노, 평온, 피곤, 기타)
- `intensity` (1~5)
- `reason_text` (문장/마크다운)
- `reason_tags` (문자열 배열)
- `attachments` (파일 메타데이터 배열)
- `visibility` (enum: PRIVATE, FRIENDS, PUBLIC)
- `visibility_overrides` (친구 ID 배열 또는 그룹 ID)
- `created_at` (UTC 타임스탬프)
- `updated_at`
- `mood_date` (사용자 로컬 기준 날짜)
- `location` (선택적, 위도/경도)
- `comments_count`
- `reactions` (이모지별 카운트 맵)
- `shared_to_feed` (boolean)

## 3. 요구사항 문서화
### 사용자 프로필
- 사용자 정보: 닉네임, 프로필 이미지, 자기소개, 위치, 시간대.
- 개인 통계: 최근 7일 감정 요약, 최다 감정 타입, 평균 감정 강도.
- 공개 범위 설정: 기본 공개 레벨, 커스텀 친구 그룹, 차단 목록.
- 활동 탭: 감정 기록, 커뮤니티 피드 참여, 배지/업적.
- 설정: 알림, 데이터 내보내기, 계정 연동.

### 커뮤니티 피드
- 타임라인: 공개/친구 범위에 따라 노출된 감정 카드.
- 상호작용: 공감(이모지), 댓글, 공유.
- 큐레이션: 추천 알고리즘(주요 감정, 태그 기반), 신고/숨기기 기능.
- 모더레이션: 신고 접수, 관리자 조치 로그, 차단 처리.
- 실시간 업데이트: 웹소켓 기반 피드 새로고침, 새 감정 기록 알림.

### 통계 데이터
- 대시보드: 주/월/연간 감정 추세, 감정 타입 분포, 감정 강도 히트맵.
- 비교 기능: 친구 평균과 비교, 이전 기간 대비 증감률.
- 다운로드: CSV/JSON 내보내기, 정기 리포트 이메일.
- 필터: 기간, 감정 타입, 공개 범위, 태그.
- 접근 제어: 사용자 본인 및 명시적 공유 대상만 접근.

## 4. 공개 범위 및 권한 모델
### 공개 범위 정의
- **PRIVATE**: 작성자만 열람 가능.
- **FRIENDS**: 승인된 친구 목록에게만 공개.
- **PUBLIC**: 모든 사용자에게 공개.
- **CUSTOM** (옵션): 특정 친구 그룹/사용자에게만 공개.

### 권한 체크 로직
1. 요청 사용자 == 작성자 → 전체 필드 열람.
2. Visibility == PUBLIC → 누구나 요약 데이터 열람, 댓글 작성 가능.
3. Visibility == FRIENDS → 요청 사용자 ∈ 작성자 친구 목록 & 차단되지 않음.
4. Visibility == PRIVATE → 작성자만 접근.
5. Visibility == CUSTOM → 요청 사용자 ∈ 지정 그룹/사용자 목록.
6. 추가 검증: 신고/차단된 관계 시 접근 차단.
7. 관리자/모더레이터는 감사 로그 남기고 접근 가능(권한 등급 필요).

### 권한 객체 모델링
- `User`: `user_id`, `role`(USER, MODERATOR, ADMIN), `status`.
- `Friendship`: 양방향 승인 상태, 그룹 태그.
- `VisibilityRule`: `entry_id`, `visibility`, `allowed_user_ids`, `allowed_group_ids`.
- `BlockList`: 차단 관계, 신고 이력.
- `AuditLog`: 관리자 열람 기록.

## 5. 분석용 데이터 저장 전략
### 원본 데이터 저장
- EmotionEntry는 OLTP DB(예: PostgreSQL)에 저장, `mood_date` 인덱싱.

### 집계 전략
- 매일 ETL 배치 작업으로 `emotion_aggregates` 테이블 업데이트.
- 컬럼: `user_id`, `week_start_date`, `emotion_type`, `entry_count`, `avg_intensity`, `positive_ratio` 등.
- 주차 계산: ISO 주차 기준, 타임존 보정.
- 파티셔닝: `week_start_date` 기준 파티션, 사용자별 인덱스.

### 분석 워크플로우
1. Raw 테이블에서 기간별 감정 데이터를 추출.
2. Week별 집계 테이블에 upsert.
3. 통계 화면은 집계 테이블을 조회하여 차트/비교 제공.
4. 장기 분석은 데이터 웨어하우스(BigQuery/Redshift)로 적재.
5. 익명화: 커뮤니티 피드 공개 데이터는 사용자 식별자 해시 처리.

### 데이터 품질 및 보관
- 스키마 변경 추적: DB 마이그레이션 도구 사용.
- 보존 정책: 원본 감정 기록 3년, 집계 데이터 5년.
- 백업: 주기적 스냅샷, 재해 복구 지역 복제.

